{"version":3,"sources":["../src/module.js"],"names":["config","PanelCtrl","_","moment","angular","BlinkenlightsPanelCtrl","$scope","$injector","$q","panelDefaults","rowHeight","numRows","numCols","padding","interval_ms","palette","defaults","panel","events","on","onInitEditMode","bind","onPanelInitalized","onRefresh","onRender","addEditorTab","editorTabIndex","refresh","lights","j","row","i","push","randomColor","render","initLights","Math","floor","random","context","console","log","rect","wrap","getBoundingClientRect","boxenwidth","width","boxenheight","height","canvas","ctx","beginPath","fillStyle","color","fill","length","scope","elem","attrs","ctrl","find","document","createElement","appendChild","$","css","getContext","$interval","get","$broadcast","templateUrl"],"mappings":"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","file":"module.js","sourcesContent":["import config from 'app/core/config';\nimport {PanelCtrl} from  'app/plugins/sdk';\n\nimport _ from 'lodash';\nimport moment from 'moment';\nimport angular from 'angular';\n\nclass BlinkenlightsPanelCtrl extends PanelCtrl {\n\n  constructor($scope, $injector, $q) {\n    super($scope, $injector, $q);\n\n    // Set and populate defaults\n    var panelDefaults = {\n      rowHeight: 100,\n      numRows: 2,\n      numCols: 8,\n      padding: 2,\n      interval_ms: 100,\n      palette: [\n        'rgba(0, 255, 42, 1)',\n        'rgba(255, 144, 0, 1)',\n        'rgba(255, 33, 0, 1)',\n        'rgba(172, 172, 172, 0.1)'\n      ]\n    };\n    _.defaults(this.panel, panelDefaults);\n\n\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n    this.events.on('panel-initialized', this.onPanelInitalized.bind(this));\n    this.events.on('refresh', this.onRefresh.bind(this));\n    this.events.on('render', this.onRender.bind(this));\n  }\n\n\n  onInitEditMode() {\n    this.addEditorTab('Options', 'public/plugins/retzkek-blinkenlights-panel/editor.html',1);\n    this.editorTabIndex = 1;\n    this.refresh();\n  }\n\n  initLights() {\n    this.lights = [];\n    for (var j=0; j < this.panel.numRows; j++) {\n      var row = [];\n      for (var i=0; i < this.panel.numCols; i++) {\n        row.push({ 'color':this.randomColor() });\n      }\n      this.lights.push(row);\n    }\n    this.render();\n  }\n\n  onPanelInitalized() {\n    //console.log(\"onPanelInitalized()\");\n    this.initLights();\n    this.render();\n  }\n\n  onConfigChanged() {\n    this.initLights();\n    this.render();\n  }\n\n  onRefresh() {\n    //console.log(\"onRefresh()\");\n    var i = Math.floor(this.panel.numCols*Math.random());\n    var j = Math.floor(this.panel.numRows*Math.random());\n    this.lights[j][i] = { 'color':this.randomColor() };\n    this.render();\n  }\n\n  onRender() {\n    if( !(this.context) ) {\n      console.log( 'No context!');\n      return;\n    }\n\n    var rect = this.wrap.getBoundingClientRect();\n\n    var boxenwidth = rect.width/this.panel.numCols;\n    var boxenheight = this.panel.rowHeight;\n\n    var height = boxenheight*this.panel.numRows;\n    this.canvas.height = height;\n    var width = rect.width;\n    this.canvas.width = width;\n\n    var ctx = this.context;\n\n    for (var j=0; j < this.panel.numRows; j++) {\n      for (var i=0; i < this.panel.numCols; i++) {\n        ctx.beginPath();\n        ctx.rect(i*boxenwidth+this.panel.padding, j*boxenheight+this.panel.padding,\n                 boxenwidth-this.panel.padding*2, boxenheight-this.panel.padding*2);\n        ctx.fillStyle = this.panel.palette[this.lights[j][i].color];\n        ctx.fill();\n      }\n    }\n  }\n\n  randomColor() {\n    return Math.floor(Math.random()*this.panel.palette.length);\n  }\n\n  link(scope, elem, attrs, ctrl) {\n    this.wrap = elem.find('.canvas-spot')[0];\n    this.canvas = document.createElement(\"canvas\");\n    this.wrap.appendChild(this.canvas);\n\n    $(this.canvas).css( 'cursor', 'pointer' );\n    $(this.wrap).css( 'width', '100%' );\n\n    //console.log( 'link', this );\n\n    this.context = this.canvas.getContext('2d');\n    //console.log(scope);\n    this.$interval = this.$injector.get('$interval');\n    this.$interval(function() {\n      scope.$broadcast('refresh');\n    }, this.panel.interval_ms);\n  }\n}\nBlinkenlightsPanelCtrl.templateUrl = 'module.html';\n\nexport {\n  BlinkenlightsPanelCtrl as PanelCtrl\n};\n\n\n"]}